{% extends "base-container.html" %}

{% block title %}launching-a-flask-app-using-aws-elastic-beanstalk{% endblock %}
{% block head %}
{{ super() }}
<link href="{{ url_for('launching_a_flask_app_using_aws_elastic_beanstalk.static', filename='style.css') }}"
      rel="stylesheet">
{% endblock %}

{% block container %}
{% filter markdown %}

# launching a flask app using aws elastic beanstalk

The following is a complete guide to launching a Flask application on a custom domain using AWS's Elastic
Beanstalk service. We are going to include all the steps that you will you need to follow for any real world example
including how Elastic Beanstalk works with version control, exposing configuration options, and setting up DNS records
for your custom-domain.

## creating a flask application

- where is the app created.
- venv, requirements.txt
- routes, template inheritance, (another post/repo on the python project template?)
- one thing to notice, the Flask app instance is not in app.py in the root like most toy examples you will find.
- This means we need to tell Elastic Beanstalk where to look for the application instance.

## configuring elastic beanstalk

- We can put configuration settings within the file `cxyz/.ebextensions/options.config`.
- Here's what the necessary settings looks like.

<pre><code>
option_settings:
  aws:elasticbeanstalk:application:environment:
    LC_ALL: en_US.utf8
    FLASK_APP: cxyz
    FLASK_ENV: production
  aws:elasticbeanstalk:container:python:
    WSGIPath: cxyz:app
</code></pre>

## packaging

- It's important to understand that the EB CLI will do its best to package our application and ship it off to AWS.
- It's also important to understand that it assumes your last commit (not the current state of your working
directory) is what you want to ship (TODO test this).
- We can go further by making sure things that aren't necessary to running the application aren't shipped off to AWS,
even if they are included in your last commit.
- We do this using a `cxyz/.ebignore` (TODO)

## initialization

- Now we initialize the Elastic Beanstalk application locally using the EB CLI.
- See [Install the EB CLI](https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb-cli3-install.html) from AWS to
install EB CLI.
- We can do this by executing the following:

<pre><code class="language-c">
  eb init -p python-3.7 cxyz --region us-east-1
</code></pre>

- This will create an `cxyz/.elasticbeanstalk/config.yml`.
- (TODO) what is this file.

## creating the environment

- Something that makes Elastic Beanstalk special is that it creates *environments* (https://stackoverflow.com/questions/33587908/how-is-an-elastic-beanstalk-instance-associated-with-route-53).
- Environments are a group of AWS resources configured to run your application.
- "Creating the environment" means spinning up those AWS resources.
- Again, we can use the EB CLI.

<pre><code class="language-c">
    eb create cxyz-env1
</code></pre>

The environment itself is composed of a couple EC2 instances, one configured to perform as an Elastic Loadbalancer
(ELB) to route traffic and one as an application host. This comes with a configuration (TODO what kind of
configuration?) to increase the number of application instances in response to demand.

- Once this environment is up and running, Elastic Beanstalk will automatically start our Flask application within
it and begin running health checks.

## viewing your application

- Go to your AWS Console and bring up the Elastic Beanstalk service.
- You should see your environment (TODO where exactly). You may find the environment is still in the process of getting
resources up-and-running.
- Once that's complete (TODO how do I know it's complete), you can go into the application where you will find a
CNAME record has been setup for your application (TODO CNAME, is that right?). The URL will look something like this.
- http://cxyz-env.eba-qrr3aehx.us-east-1.elasticbeanstalk.com/
- You should find the home page of your application running at this address.

NOTE: If the application is reporting an unhealthy state, you need to look into the logs. Most often this is a
configuration error. The logs will attempt to communicate the nature of the issue whatever the cause. You can access
the logs by selecting (TODO). Update the application

NOTE: If you find static assets like styling, or images, are not loading. It's likely because you have an ad-blocker
running and it has decided the URL Elastic Beanstalk's machine-generated URL looks too shady. Suspend your ad-blocker
and your problems should go away.

## setting up your elastic beanstalk application with your custom domain

- We want requests to your custom domain to be routed to your Elastic Beanstalk application, not the machine
generated URL Elastic Beanstalk provides you by default.
- We need to configure DNS to do this, and Route 53 makes it pretty easy, if you know what you're doing.
- (TODO walk through this process)
- Now visit your-custom-domain.com.

{% endfilter %}
{% endblock %}

{% block footer %}
{{ super() }}
<script src="{{ url_for('launching_a_flask_app_using_aws_elastic_beanstalk.static', filename='launching-a-flask-app-using-aws-elastic-beanstalk.js') }}"
        type="text/javascript"></script>
<script>
    $("#loading").removeClass('active');
</script>
{% endblock %}
